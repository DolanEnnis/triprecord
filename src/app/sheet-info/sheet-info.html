<div class="reconciliation-container">
  <!-- PDF Daily Diary Section -->
  <mat-card style="margin-top: 20px;">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>picture_as_pdf</mat-icon>
        Daily Diary PDF
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      @if (pdfLoading()) {
        <div class="loading-container">
          <mat-spinner diameter="40"></mat-spinner>
          <p style="margin-top: 16px; font-weight: 500;">Working on Day Diary, Fetching the info for you, this can take a couple of Mins! Sorry!</p>
          @if (loadingStep()) {
            <p style="margin-top: 8px; color: #666; font-size: 14px;">{{ loadingStep() }}</p>
          }
        </div>
      }

      @if (pdfError()) {
        <div class="error-message" style="margin-top: 16px;">
          <mat-icon color="warn">error</mat-icon>
          <p>{{ pdfError() }}</p>
          <button mat-raised-button color="primary" (click)="fetchPdf()" style="margin-top: 12px;">
            <mat-icon>refresh</mat-icon>
            Retry
          </button>
        </div>
      }

      @if (pdfShips().length > 0) {
        <div style="margin-top: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <h3 style="margin: 0;">Extracted Ships ({{ pdfShipsCount() }})</h3>
            @if (lastProcessed()) {
              <span style="color: #666; font-size: 14px;">Last updated: {{ lastProcessed() | date:'dd/MM/yyyy HH:mm' }}</span>
            }
          </div>
          <table mat-table [dataSource]="pdfShips()" style="width: 100%; margin-top: 12px;">
            
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Vessel Name</th>
              <td mat-cell *matCellDef="let ship">{{ ship.name }}</td>
            </ng-container>

            <ng-container matColumnDef="gt">
              <th mat-header-cell *matHeaderCellDef>GT</th>
              <td mat-cell *matCellDef="let ship">{{ ship.gt | number }}</td>
            </ng-container>

            <ng-container matColumnDef="port">
              <th mat-header-cell *matHeaderCellDef>Port</th>
              <td mat-cell *matCellDef="let ship">{{ ship.port }}</td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let ship">{{ ship.status }}</td>
            </ng-container>

            <ng-container matColumnDef="eta">
              <th mat-header-cell *matHeaderCellDef>ETA</th>
              <td mat-cell *matCellDef="let ship">
                @if (ship.eta) {
                  {{ ship.eta | date:'dd/MM HH:mm' }}
                } @else {
                  -
                }
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['name', 'gt', 'port', 'status', 'eta']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['name', 'gt', 'port', 'status', 'eta'];"></tr>
          </table>
        </div>

        <details style="margin-top: 20px;">
          <summary style="cursor: pointer; font-weight: 500;">Show Raw PDF Text</summary>
          <pre style="background: #f5f5f5; padding: 16px; overflow: auto; max-height: 400px; border: 1px solid #ddd; margin-top: 12px;">{{ pdfText() }}</pre>
        </details>
      } @else if (pdfText()) {
        <div style="margin-top: 20px;">
          <h3>PDF Content (Raw Text - No Ships Found)</h3>
          <pre style="background: #f5f5f5; padding: 16px; overflow: auto; max-height: 600px; border: 1px solid #ddd;">{{ pdfText() }}</pre>
        </div>
      }
    </mat-card-content>
  </mat-card>
</div>

