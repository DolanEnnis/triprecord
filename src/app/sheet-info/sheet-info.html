<div class="reconciliation-container">
  <!-- PDF Daily Diary Section -->
  <mat-card class="pdf-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>picture_as_pdf</mat-icon>
        <a href="http://www.cargopro.ie/sfpc/download/rpt_daydiary.pdf" target="_blank" rel="noopener noreferrer">Day Diary PDF</a>
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      @if (pdfLoading()) {
        <div class="loading-container">
          <mat-spinner diameter="40"></mat-spinner>
          <p class="loading-message">Working on Day Diary, Fetching the info for you, this can take a couple of Mins! Sorry!</p>
          @if (loadingStep()) {
            <p class="loading-step">{{ loadingStep() }}</p>
          }
        </div>
      }

      @if (pdfError()) {
        <div class="error-message">
          <mat-icon color="warn">error</mat-icon>
          <p>{{ pdfError() }}</p>
          <button mat-raised-button color="primary" (click)="fetchPdf()" class="retry-button">
            <mat-icon>refresh</mat-icon>
            Retry
          </button>
        </div>
      }

      @if (pdfShips().length > 0) {
        <div class="ships-section">
          <div class="ships-header">
            <h3>Extracted Ships ({{ pdfShipsCount() }})</h3>
            @if (lastProcessed()) {
              <span class="last-updated">Last updated: {{ lastProcessed() | date:'dd/MM/yyyy HH:mm' }}</span>
            }
          </div>
          <table mat-table [dataSource]="pdfShips()" class="ships-table">
            
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Vessel Name</th>
              <td mat-cell *matCellDef="let ship">{{ ship.name }}</td>
            </ng-container>

            <ng-container matColumnDef="gt">
              <th mat-header-cell *matHeaderCellDef>GT</th>
              <td mat-cell *matCellDef="let ship">{{ ship.gt | number }}</td>
            </ng-container>

            <ng-container matColumnDef="port">
              <th mat-header-cell *matHeaderCellDef>Port</th>
              <td mat-cell *matCellDef="let ship">{{ ship.port }}</td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let ship">{{ ship.status }}</td>
            </ng-container>

            <ng-container matColumnDef="eta">
              <th mat-header-cell *matHeaderCellDef>ETA</th>
              <td mat-cell *matCellDef="let ship">
                @if (ship.eta) {
                  {{ ship.eta | date:'dd/MM HH:mm' }}
                } @else {
                  -
                }
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>

        <details class="raw-text-details">
          <summary class="raw-text-summary">Show Raw PDF Text</summary>
          <pre class="raw-text-content">{{ pdfText() }}</pre>
        </details>
      } @else if (pdfText()) {
        <div class="no-ships-section">
          <h3>PDF Content (Raw Text - No Ships Found)</h3>
          <pre class="raw-text-content raw-text-large">{{ pdfText() }}</pre>
        </div>
      }
    </mat-card-content>
  </mat-card>
</div>

